<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NexAgent Microservice Platform</title>
    <!-- Firebase SDKs -->
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
    <script type="module" src="https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js"></script>
    <!-- Leaflet for the Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4xn+LzC0XlVbYFwF+p4S8s4+x0u1w78w1e4f4r4s6g=" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-2BqFz1b1lK7yD7o7p1K6z6s6X5p2h2w1s6y6r4s6g=" crossorigin=""></script>
    <style>
        :root {
            --bg-dark: #0a0a0e;
            --text-light: #e0e0e0;
            --text-medium: #a0a0a0;
            --card-bg-glass: rgba(255, 255, 255, 0.08);
            --border-glass: rgba(255, 255, 255, 0.15);
            --accent-gradient: linear-gradient(45deg, #00C9FF, #92FE9D);
            --accent-color-start: #00C9FF;
            --accent-color-end: #92FE9D;
            --glow-color: #00C9FF;
            --neumorphic-shadow-dark: 10px 10px 20px rgba(0, 0, 0, 0.4), -10px -10px 20px rgba(25, 25, 30, 0.6);
            --button-shadow-dark: 5px 5px 10px rgba(0, 0, 0, 0.3), -5px -5px 10px rgba(25, 25, 30, 0.4);
            --input-bg: rgba(0, 0, 0, 0.3);
            --input-border: rgba(255, 255, 255, 0.1);
            --font-mono: 'Space Mono', monospace;
            --font-sans: 'Inter', sans-serif;
            --header-height: 80px;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Space+Mono:wght@400;700&display=swap');

        /* Global Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-sans);
            background: var(--bg-dark);
            color: var(--text-light);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        /* Utility Classes */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .text-gradient {
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .button {
            background: var(--accent-gradient);
            color: var(--bg-dark);
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--button-shadow-dark);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }

        .button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 0 15px var(--glow-color), var(--button-shadow-dark);
        }

        .card {
            background: var(--card-bg-glass);
            border: 1px solid var(--border-glass);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 30px;
            box-shadow: var(--neumorphic-shadow-dark);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden; /* For inner glow effects */
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 25px rgba(0, 201, 255, 0.4), var(--neumorphic-shadow-dark);
        }

        input[type="text"],
        input[type="password"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            margin-bottom: 15px;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            color: var(--text-light);
            font-family: var(--font-sans);
            font-size: 1rem;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }

        input[type="text"]:focus,
        input[type="password"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-color-start);
            box-shadow: 0 0 0 3px rgba(0, 201, 255, 0.3);
        }

        textarea {
            min-height: 120px;
            resize: vertical;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: var(--font-mono);
            font-weight: 700;
            margin-bottom: 20px;
        }

        h1 { font-size: 3.5rem; line-height: 1.1; }
        h2 { font-size: 2.5rem; line-height: 1.2; margin-top: 40px;}
        h3 { font-size: 1.8rem; line-height: 1.3; }

        .section-title {
            text-align: center;
            margin-bottom: 60px;
        }
        .section-title h2 {
            margin-bottom: 15px;
        }
        .section-title p {
            font-size: 1.1rem;
            color: var(--text-medium);
        }

        /* Header */
        #main-header {
            background-color: rgba(10, 10, 14, 0.8);
            backdrop-filter: blur(8px);
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        #main-header .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: var(--font-mono);
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-light);
            text-decoration: none;
        }

        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 30px;
        }

        .main-nav a {
            color: var(--text-medium);
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
            position: relative;
        }

        .main-nav a::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -5px;
            width: 0;
            height: 2px;
            background: var(--accent-gradient);
            transition: width 0.3s ease;
        }

        .main-nav a:hover, .main-nav a.active {
            color: var(--text-light);
        }

        .main-nav a:hover::after, .main-nav a.active::after {
            width: 100%;
        }

        .auth-buttons button {
            background: transparent;
            border: 1px solid var(--border-glass);
            color: var(--text-light);
            padding: 8px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            margin-left: 10px;
        }

        .auth-buttons button:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: var(--accent-color-start);
            box-shadow: 0 0 8px rgba(0, 201, 255, 0.3);
        }

        /* Main Content & Page Management */
        main {
            flex-grow: 1;
            padding: 60px 0;
        }

        .page {
            display: none;
            animation: fadeIn 0.8s ease-out forwards;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hero Section */
        #hero-section {
            text-align: center;
            padding: 120px 0;
            min-height: calc(100vh - var(--header-height));
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: radial-gradient(circle at center, rgba(0, 201, 255, 0.05) 0%, transparent 70%);
        }

        #hero-section::before, #hero-section::after {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(80px);
            animation: glowMove 15s infinite alternate;
            z-index: -1;
        }

        #hero-section::before {
            background-color: var(--accent-color-start);
            top: 10%;
            left: 5%;
        }

        #hero-section::after {
            background-color: var(--accent-color-end);
            bottom: 10%;
            right: 5%;
            animation-delay: 3s;
        }

        @keyframes glowMove {
            0% { transform: translate(0, 0); }
            25% { transform: translate(50px, -50px); }
            50% { transform: translate(100px, 0); }
            75% { transform: translate(50px, 50px); }
            100% { transform: translate(0, 0); }
        }

        #hero-section h1 {
            font-size: 4.5rem;
            margin-bottom: 25px;
        }

        #hero-section p {
            font-size: 1.4rem;
            color: var(--text-medium);
            max-width: 800px;
            margin: 0 auto 40px;
        }

        /* Auth Section */
        #auth-section {
            padding: 80px 0;
            text-align: center;
        }

        #auth-section .auth-container {
            max-width: 450px;
            margin: 0 auto;
        }

        #auth-section .card {
            padding: 40px;
        }

        #auth-section h2 {
            font-size: 2rem;
            margin-bottom: 30px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-medium);
            font-weight: 600;
        }

        .auth-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .auth-options button {
            flex: 1;
            background: transparent;
            border: 1px solid var(--border-glass);
            color: var(--text-light);
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .auth-options button.active, .auth-options button:hover {
            border-color: var(--accent-color-start);
            background: rgba(0, 201, 255, 0.1);
        }

        .social-login button {
            width: 100%;
            background: #4285F4; /* Google blue */
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: background-color 0.3s ease;
        }

        .social-login button:hover {
            background: #357ae8;
        }
        .social-login img {
            width: 20px;
            height: 20px;
        }

        .form-switch {
            margin-top: 20px;
            color: var(--text-medium);
            font-size: 0.9rem;
        }
        .form-switch a {
            color: var(--accent-color-start);
            text-decoration: none;
            font-weight: 600;
        }
        .form-switch a:hover {
            text-decoration: underline;
        }

        /* Dashboard Section */
        #dashboard-section {
            padding: 60px 0;
        }

        #dashboard-section h2 {
            margin-bottom: 40px;
            text-align: center;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        /* Map Styling */
        #map {
            height: 400px;
            border-radius: 12px;
            box-shadow: var(--neumorphic-shadow-dark);
            background-color: var(--input-bg);
            border: 1px dashed var(--border-glass);
        }

        .property-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        /* Custom scrollbar for property list */
        .property-list::-webkit-scrollbar {
            width: 8px;
        }

        .property-list::-webkit-scrollbar-track {
            background: var(--input-bg);
            border-radius: 10px;
        }

        .property-list::-webkit-scrollbar-thumb {
            background: var(--border-glass);
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }
        
        .property-list::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .property-card {
            display: flex;
            background: var(--card-bg-glass);
            border: 1px solid var(--border-glass);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            align-items: center;
            gap: 15px;
            box-shadow: var(--button-shadow-dark);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .property-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 12px rgba(0, 201, 255, 0.3), var(--button-shadow-dark);
        }

        .property-thumbnail {
            width: 80px;
            height: 80px;
            border-radius: 8px;
            flex-shrink: 0;
            overflow: hidden;
            position: relative;
        }
        
        .property-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .property-card:hover .property-thumbnail img {
            transform: scale(1.05);
        }

        .property-info h3 {
            margin-bottom: 5px;
            font-size: 1.2rem;
            color: var(--text-light);
        }
        .property-info p {
            font-size: 0.9rem;
            color: var(--text-medium);
            margin-bottom: 8px;
        }
        .property-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .tag {
            background: rgba(0, 201, 255, 0.15);
            color: var(--accent-color-start);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            font-family: var(--font-mono);
        }
        .tag.high-yield { background: rgba(146, 254, 157, 0.15); color: #92FE9D; }
        .tag.risky { background: rgba(255, 0, 0, 0.15); color: #FF6B6B; }
        .tag.undervalued { background: rgba(255, 204, 0, 0.15); color: #FFCC00; }

        /* Property Detail Section */
        #property-detail-section {
            padding: 60px 0;
        }
        #property-detail-section h2 {
            margin-bottom: 40px;
            text-align: center;
        }
        .detail-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }
        .detail-main-content {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .prop-image {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--neumorphic-shadow-dark);
        }

        .prop-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .prop-details h3 {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        .prop-details p {
            color: var(--text-medium);
            margin-bottom: 10px;
        }
        .ai-insights h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-glass);
            padding-bottom: 10px;
        }
        .ai-insights ul {
            list-style: none;
        }
        .ai-insights ul li {
            background: rgba(0, 201, 255, 0.05);
            border-left: 3px solid var(--accent-color-start);
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            font-size: 0.95rem;
            color: var(--text-medium);
        }
        .feedback-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-glass);
            text-align: center;
        }
        .feedback-section p {
            margin-bottom: 10px;
        }
        .feedback-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .feedback-buttons button {
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 6px;
            cursor: pointer;
            border: 1px solid var(--border-glass);
            background: transparent;
            color: var(--text-medium);
            transition: all 0.2s ease;
        }
        .feedback-buttons button:hover {
            border-color: var(--accent-color-start);
            background: rgba(0, 201, 255, 0.1);
            color: var(--text-light);
        }

        .action-panel h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        .action-panel .button {
            width: 100%;
            margin-bottom: 15px;
            justify-content: center;
        }
        .agents-at-work {
            margin-top: 30px;
            text-align: center;
        }
        .agents-at-work h4 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--text-light);
        }
        .agent-status-bar {
            background: var(--input-bg);
            border-radius: 8px;
            height: 10px;
            overflow: hidden;
            position: relative;
        }
        .agent-status-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 30%; /* Initial progress */
            background: var(--accent-gradient);
            border-radius: 8px;
            animation: progressPulse 2s infinite alternate;
        }
        @keyframes progressPulse {
            0% { width: 0%; opacity: 0.5; }
            50% { width: 70%; opacity: 1; }
            100% { width: 100%; opacity: 0.5; }
        }

        /* Agent Stack Showcase */
        #agent-showcase-section {
            padding: 80px 0;
            position: relative;
            overflow: hidden;
        }
        #agent-showcase-section .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            position: relative;
            margin-top: 60px;
            z-index: 1;
        }
        .agent-card {
            text-align: center;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .agent-card h3 {
            font-size: 1.6rem;
            margin-bottom: 15px;
            color: var(--accent-color-start);
        }
        .agent-card p {
            font-size: 0.95rem;
            color: var(--text-medium);
        }
        .agent-card .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .line-connector {
            position: absolute;
            background: var(--accent-gradient);
            opacity: 0.3;
            animation: lineGlow 5s infinite alternate;
            z-index: 0;
        }
        @keyframes lineGlow {
            0% { opacity: 0.3; background-position: 0% 50%; }
            50% { opacity: 0.7; background-position: 100% 50%; }
            100% { opacity: 0.3; background-position: 0% 50%; }
        }

        /* Scalability Section */
        #scalability-section {
            padding: 80px 0;
            text-align: center;
        }
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 60px;
        }
        .metric-card {
            padding: 30px;
            text-align: left;
        }
        .metric-card h3 {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--accent-color-end);
        }
        .metric-card p {
            color: var(--text-medium);
            margin-bottom: 20px;
            font-size: 0.95rem;
        }
        .sparkline-container {
            height: 80px;
            width: 100%;
            background: var(--input-bg);
            border-radius: 8px;
            overflow: hidden;
            padding: 5px;
            display: flex;
            align-items: flex-end;
            gap: 2px;
        }
        .sparkline-bar {
            width: 8px;
            background: linear-gradient(to top, var(--accent-color-start), var(--accent-color-end));
            border-radius: 2px;
            transition: height 0.5s ease;
        }

        /* Due Diligence Section */
        #due-diligence-section {
            padding: 80px 0;
        }
        .dd-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        .input-panel, .output-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .output-panel {
            position: relative;
        }
        .output-panel h3 {
            margin-bottom: 15px;
        }
        .dd-result-area {
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            padding: 20px;
            min-height: 350px;
            white-space: pre-wrap;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            color: var(--text-light);
            line-height: 1.8;
            overflow-y: auto;
            max-height: 500px;
        }
        .dd-status {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--text-medium);
        }
        .dd-status div {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--border-glass);
            border-radius: 6px;
        }
        .dd-status div.active {
            border-left-color: var(--accent-color-start);
            color: var(--text-light);
            background: rgba(0, 201, 255, 0.1);
        }
        .dd-status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: var(--text-medium);
            margin-right: 8px;
            animation: none;
        }
        .dd-status div.active .dd-status-indicator {
            background-color: var(--accent-color-start);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        .dd-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* CTA Section */
        #cta-section {
            padding: 100px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        #cta-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: var(--accent-gradient);
            box-shadow: 0 0 15px var(--glow-color);
        }
        #cta-section h2 {
            font-size: 3rem;
            margin-bottom: 30px;
        }

        /* Footer */
        #main-footer {
            background-color: var(--bg-dark);
            padding: 30px 0;
            text-align: center;
            color: var(--text-medium);
            border-top: 1px solid var(--border-glass);
            font-size: 0.9rem;
        }
        
        /* AI Chatbot Button & Container */
        #chatbot-toggle-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-gradient);
            color: var(--bg-dark);
            border: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 2000;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        #chatbot-toggle-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .chatbot-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 380px;
            height: 500px;
            background: var(--card-bg-glass);
            border: 1px solid var(--border-glass);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: var(--neumorphic-shadow-dark);
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 2000;
        }
        .chatbot-header {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-glass);
        }
        .chatbot-header h3 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--text-light);
        }
        .chatbot-close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-medium);
            cursor: pointer;
        }
        .chatbot-close-btn:hover {
            color: var(--accent-color-start);
        }
        .chatbot-messages {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .chatbot-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid var(--border-glass);
            background: var(--input-bg);
        }
        .chatbot-input-area input {
            flex-grow: 1;
            background: transparent;
            border: none;
            margin-right: 10px;
            color: var(--text-light);
        }
        .chatbot-input-area input:focus {
            outline: none;
            box-shadow: none;
        }
        .chatbot-send-btn {
            background: none;
            border: none;
            color: var(--accent-color-start);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .message {
            max-width: 85%;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.95rem;
        }
        .message.user {
            background: rgba(0, 201, 255, 0.2);
            align-self: flex-end;
            text-align: right;
            border-bottom-right-radius: 2px;
        }
        .message.bot {
            background: rgba(255, 255, 255, 0.1);
            align-self: flex-start;
            text-align: left;
            border-bottom-left-radius: 2px;
        }
        .message .loading-dots span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--text-light);
            animation: dot-flicker 1.4s infinite;
            margin: 0 2px;
        }
        .message .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .message .loading-dots span:nth-child(3) { animation-delay: 0.4s; }
        @keyframes dot-flicker {
            0%, 80%, 100% { transform: scale(0); opacity: 0; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* Responsive Adjustments */
        @media (max-width: 992px) {
            .dashboard-grid, .detail-grid, .dd-grid {
                grid-template-columns: 1fr;
            }
            #main-header .container {
                flex-direction: column;
                gap: 20px;
            }
            .main-nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            #hero-section h1 {
                font-size: 3rem;
            }
            #hero-section p {
                font-size: 1.1rem;
            }
            .section-title h2 {
                font-size: 2rem;
            }
            .agent-showcase-section .grid-container, .metric-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            .chatbot-container {
                width: 90%;
                left: 5%;
                bottom: 80px;
                right: auto;
                height: 400px;
            }
            #chatbot-toggle-button {
                bottom: 20px;
                right: 20px;
            }
        }

        @media (max-width: 768px) {
            h1 { font-size: 2.8rem; }
            h2 { font-size: 2rem; }
            .main-nav ul {
                gap: 15px;
            }
            .auth-options {
                flex-direction: column;
            }
            .property-card {
                flex-direction: column;
                align-items: flex-start;
            }
            .property-thumbnail {
                width: 100%;
                height: 120px;
            }
            .metric-card h3 {
                font-size: 1.5rem;
            }
            .dd-result-area {
                min-height: 250px;
            }
        }

        @media (max-width: 480px) {
            #hero-section h1 {
                font-size: 2.2rem;
            }
            #hero-section p {
                font-size: 1rem;
            }
            .button {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            .main-nav ul {
                gap: 10px;
                font-size: 0.9rem;
            }
        }

    </style>
</head>
<body>
    <div id="app">
        <header id="main-header">
            <div class="container">
                <a href="#" class="logo" data-nav-target="hero-section">NexAgent</a>
                <nav class="main-nav">
                    <ul>
                        <li><a href="#" data-nav-target="hero-section" class="active">Home</a></li>
                        <li><a href="#" data-nav-target="dashboard-section">Dashboard</a></li>
                        <li><a href="#" data-nav-target="agent-showcase-section">Agents</a></li>
                        <li><a href="#" data-nav-target="due-diligence-section">Due Diligence Demo</a></li>
                        <li><a href="#" data-nav-target="scalability-section">Scalability</a></li>
                    </ul>
                </nav>
                <div class="auth-buttons">
                    <button id="login-button" data-nav-target="auth-section">Login</button>
                    <button id="signup-button" data-nav-target="auth-section">Sign Up</button>
                    <button id="logout-button" style="display:none;">Logout</button>
                </div>
            </div>
        </header>

        <main>
            <section id="hero-section" class="page active">
                <div class="container">
                    <h1>Unleash <span class="text-gradient">Agentic Intelligence</span> in Real Estate</h1>
                    <p>Revolutionizing property analysis and investment with a robust, microservice-powered agent architecture. For tech-savvy professionals and visionary investors.</p>
                    <button class="button" data-nav-target="agent-showcase-section">🚀 See Agents in Action</button>
                </div>
            </section>

            <section id="auth-section" class="page">
                <div class="container auth-container">
                    <div class="card">
                        <div class="auth-options">
                            <button id="show-login" class="active">Login</button>
                            <button id="show-signup">Sign Up</button>
                        </div>
                        <div id="login-form">
                            <h2>Login to NexAgent</h2>
                            <div class="form-group">
                                <label for="login-email">Email</label>
                                <input type="email" id="login-email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="login-password">Password</label>
                                <input type="password" id="login-password" placeholder="••••••••">
                            </div>
                            <button class="button" id="login-submit">Login</button>
                            <div class="form-switch">
                                <a href="#">Forgot Password?</a>
                            </div>
                            <div class="social-login">
                                <button id="google-oauth-button"><img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnPg" alt="Google icon"> Continue with Google</button>
                            </div>
                        </div>
                        <div id="signup-form" style="display:none;">
                            <h2>Join NexAgent</h2>
                            <div class="form-group">
                                <label for="signup-email">Email</label>
                                <input type="email" id="signup-email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label for="signup-password">Password</label>
                                <input type="password" id="signup-password" placeholder="••••••••">
                            </div>
                            <div class="form-group">
                                <label for="signup-confirm-password">Confirm Password</label>
                                <input type="password" id="signup-confirm-password" placeholder="••••••••">
                            </div>
                            <button class="button" id="signup-submit">Sign Up</button>
                            <div class="form-switch">
                                Already have an account? <a href="#" id="switch-to-login">Login</a>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="dashboard-section" class="page">
                <div class="container">
                    <div class="section-title">
                        <h2>Your Personalized <span class="text-gradient">Investment Dashboard</span></h2>
                        <p>Leverage AI-powered insights to discover high-potential properties and manage your portfolio.</p>
                    </div>
                    <div class="dashboard-grid">
                        <div class="card">
                            <h3>Dynamic Property Map</h3>
                            <div id="map"></div>
                        </div>
                        <div class="card">
                            <h3>Property List View</h3>
                            <div class="property-list" id="property-list">
                                <!-- Property cards will be injected here -->
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="property-detail-section" class="page">
                <div class="container">
                    <h2 class="section-title">Property Details & <span class="text-gradient">AI Insights</span></h2>
                    <div class="detail-grid">
                        <div class="card detail-main-content">
                            <div class="prop-image">
                                <!-- Property image will be injected here -->
                            </div>
                            <div class="prop-details">
                                <h3 id="detail-prop-title">Luxury Condo at Tech Hub</h3>
                                <p id="detail-prop-address">123 Innovate Street, Future City, FC 90210</p>
                                <p><strong>Price:</strong> $<span id="detail-prop-price">1,500,000</span> | <strong>Beds:</strong> <span id="detail-prop-beds">3</span> | <strong>Baths:</strong> <span id="detail-prop-baths">2.5</span> | <strong>Sq. Ft.:</strong> <span id="detail-prop-sqft">2,200</span></p>
                                <p id="detail-prop-description">A state-of-the-art condominium designed for the future, featuring smart home integration, panoramic city views, and unparalleled amenities. Located in the heart of the burgeoning tech district.</p>
                                <button class="button" id="ai-summary-button">✨ Generate AI Summary</button>
                            </div>
                            <div class="ai-insights">
                                <h3>Explainable AI Insights</h3>
                                <ul id="explainable-ai-list">
                                    <li>Market Sentiment: "Strong Growth Potential (92%) due to recent tech company influx."</li>
                                    <li>Risk Assessment: "Low-Medium. Potential for interest rate hikes affecting financing."</li>
                                    <li>Comparative Analysis: "Valued ~8% below comparable properties in the last 6 months."</li>
                                    <li>Future Outlook: "Projected 15% appreciation over next 3 years based on urban development plans."</li>
                                </ul>
                                <div class="feedback-section">
                                    <p>Did we get this right? Help our agents learn:</p>
                                    <div class="feedback-buttons">
                                        <button id="feedback-yes-button">👍 Yes</button>
                                        <button id="feedback-no-button">👎 No</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card action-panel">
                            <h3>Next Steps</h3>
                            <button class="button" id="add-to-leads-button">Add to Leads</button>
                            <button class="button" id="contact-owner-button">Contact Owner</button>
                            <button class="button" id="start-dd-button">✨ Start Due Diligence</button>

                            <div class="agents-at-work">
                                <h4>Agents at Work</h4>
                                <p class="text-medium">Analyzing data & coordinating tasks...</p>
                                <div class="agent-status-bar"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="agent-showcase-section" class="page">
                <div class="container">
                    <div class="section-title">
                        <h2>Our <span class="text-gradient">Agent Stack</span>: Intelligent Automation at Work</h2>
                        <p>A network of specialized AI agents working collaboratively to accelerate your real estate decisions.</p>
                    </div>
                    <div class="grid-container">
                        <div class="card agent-card" id="agent-card-scout">
                            <div class="icon">🔍</div>
                            <h3>Scout Agent</h3>
                            <p>Identifies emerging opportunities, market trends, and off-market properties globally.</p>
                        </div>
                        <div class="card agent-card" id="agent-card-underwriting">
                            <div class="icon">💰</div>
                            <h3>Underwriting Agent</h3>
                            <p>Assesses financial viability, risk profiles, and investment returns for potential acquisitions.</p>
                        </div>
                        <div class="card agent-card" id="agent-card-negotiation">
                            <div class="icon">🤝</div>
                            <h3>Negotiation Agent</h3>
                            <p>Optimizes deal terms, communicates with stakeholders, and manages offer/counter-offer cycles.</p>
                        </div>
                        <div class="card agent-card" id="agent-card-due-diligence">
                            <div class="icon">✅</div>
                            <h3>Due Diligence Agent</h3>
                            <p>Analyzes contracts, reports, and legal documents to flag risks and compliance issues.</p>
                        </div>
                        <div class="card agent-card" id="agent-card-workflow">
                            <div class="icon">⚙️</div>
                            <h3>Workflow Agent</h3>
                            <p>Orchestrates agent interactions, tracks project progress, and ensures seamless operation.</p>
                        </div>
                        <!-- Line Connectors (positioned via JS for dynamic layouts, for this demo, will be minimal/implied) -->
                    </div>
                </div>
            </section>

            <section id="due-diligence-section" class="page">
                <div class="container">
                    <div class="section-title">
                        <h2><span class="text-gradient">Due Diligence Agent</span> Demo: Automated Risk Flagging</h2>
                        <p>Experience the precision of AI in autonomously analyzing complex documents for critical insights.</p>
                    </div>
                    <div class="dd-grid">
                        <div class="card input-panel">
                            <h3>Input Documents</h3>
                            <label for="inspection-report">Mock Inspection Report (Paste Text)</label>
                            <textarea id="inspection-report" placeholder="Paste full inspection report text here...">
HVAC unit is 15 years old. Roof has minor wear, 5 years remaining life. Electrical panel is outdated, potential for future upgrade costs. Basement shows signs of historical moisture intrusion, now mitigated. No structural damage found.
Outdoor landscaping requires maintenance. Water heater 8 years old.

Environmental check: No known hazards.
Permits: All major renovations have permits on file.
                            </textarea>

                            <label for="contract-text">Mock Contract / Lease (Paste Text)</label>
                            <textarea id="contract-text" placeholder="Paste contract/lease details here...">
Lease agreement for Tenant A expires on 2024-12-31. Current rent $3000/month.
Property has a recorded easement for public utility access along the northern boundary.
No active litigation. Property taxes are current.
Purchase price $1.2M. Closing date 2023-11-15.
Seller warrants no undisclosed defects.
                            </textarea>
                            <div class="dd-actions">
                                <button class="button" id="run-dd-agent-button">✨ Run Due Diligence Agent</button>
                                <button class="button" id="pull-data-button">🔌 Pull More Data</button>
                            </div>
                        </div>
                        <div class="card output-panel">
                            <h3>Agent Output & Status</h3>
                            <div id="dd-result-area" class="dd-result-area">
                                Click "Run Due Diligence Agent" to analyze documents.
                            </div>
                            <div class="dd-status">
                                <div id="status-workflow"><span class="dd-status-indicator"></span>Workflow Coordinator: Awaiting Input</div>
                                <div id="status-data-underwriting"><span class="dd-status-indicator"></span>Data & Underwriting Agent: Idle</div>
                                <div id="status-dd-agent"><span class="dd-status-indicator"></span>Due Diligence Agent: Idle</div>
                                <div id="status-negotiation-comm"><span class="dd-status-indicator"></span>Negotiation/Communication Agent: Idle</div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="scalability-section" class="page">
                <div class="container">
                    <div class="section-title">
                        <h2>Scalability & Feedback: <span class="text-gradient">Performance at Scale</span></h2>
                        <p>Designed for unparalleled performance, handling millions of records and scaling agents horizontally.</p>
                    </div>
                    <div class="metric-grid">
                        <div class="card metric-card">
                            <h3>Millions of Records Processed</h3>
                            <p>Our agents efficiently process vast datasets, ensuring comprehensive analysis.</p>
                            <div class="sparkline-container" id="sparkline-records"></div>
                        </div>
                        <div class="card metric-card">
                            <h3>Horizontal Agent Scaling</h3>
                            <p>Dynamically scale agent instances to meet demand, maintaining peak performance.</p>
                            <div class="sparkline-container" id="sparkline-agents"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="cta-section" class="page">
                <div class="container">
                    <h2>Ready to Transform Your <span class="text-gradient">Real Estate Operations</span>?</h2>
                    <p>Unlock the power of AI-driven insights and automated workflows.</p>
                    <button class="button" data-nav-target="auth-section">🚀 Get Started Today</button>
                </div>
            </section>
        </main>

        <footer id="main-footer">
            <div class="container">
                <p>&copy; 2023 NexAgent Microservice Platform. All rights reserved.</p>
            </div>
        </footer>
    </div>
    
    <!-- Custom Modal for Alerts -->
    <div id="custom-alert" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--bg-dark); border: 1px solid var(--border-glass); border-radius: 10px; padding: 25px; z-index: 10000; box-shadow: var(--neumorphic-shadow-dark); text-align: center;">
        <p id="alert-message" style="margin-bottom: 20px; font-size: 1.1rem;"></p>
        <button id="alert-ok-button" class="button">OK</button>
    </div>
    <div id="modal-backdrop" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999;"></div>
    
    <!-- Communication Agent Modal -->
    <div id="email-modal" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 500px; background: var(--bg-dark); border: 1px solid var(--border-glass); border-radius: 10px; padding: 30px; z-index: 10000; box-shadow: var(--neumorphic-shadow-dark);">
        <h3 style="margin-bottom: 20px;">Drafting Email to Owner...</h3>
        <textarea id="email-draft-area" style="width: 100%; min-height: 200px; margin-bottom: 15px;"></textarea>
        <button class="button" id="send-email-button" style="width: 100%;">Send Email (Simulated)</button>
        <button class="button" id="close-email-modal" style="width: 100%; margin-top: 10px; background: none; border: 1px solid var(--border-glass); color: var(--text-light);">Cancel</button>
    </div>

    <!-- AI Chatbot UI -->
    <button id="chatbot-toggle-button">💬</button>
    <div class="chatbot-container" id="chatbot-container">
        <div class="chatbot-header">
            <h3>AI Assistant</h3>
            <button class="chatbot-close-btn" id="chatbot-close-btn">✖️</button>
        </div>
        <div class="chatbot-messages" id="chatbot-messages">
            <div class="message bot">Hello! I'm your AI Real Estate Assistant. How can I help you?</div>
        </div>
        <div class="chatbot-input-area">
            <input type="text" id="chatbot-input" placeholder="Ask a question...">
            <button id="chatbot-send-btn">➡️</button>
        </div>
    </div>
    
    <!-- Moved Leaflet script to just before the module script for proper loading order -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-2BqFz1b1lK7yD7o7p1K6z6s6X5p2h2w1s6y6r4s6g=" crossorigin=""></script>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-analytics.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyCxguLep-pwr7orZ_-RvwF4k08KhwdDbQs",
          authDomain: "aashutosh-ai-builder-123.firebaseapp.com",
          projectId: "aashutosh-ai-builder-123",
          storageBucket: "aashutosh-ai-builder-123.firebasestorage.app",
          messagingSenderId: "865169890427",
          appId: "1:865169890427:web:923e5746de6a1c248ed6de",
          measurementId: "G-0LHKTS76TR"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);

        // --- Custom Alert/Modal Functions ---
        function showCustomAlert(message) {
            document.getElementById('alert-message').textContent = message;
            document.getElementById('custom-alert').style.display = 'block';
            document.getElementById('modal-backdrop').style.display = 'block';
        }
        function hideCustomAlert() {
            document.getElementById('custom-alert').style.display = 'none';
            document.getElementById('modal-backdrop').style.display = 'none';
        }
        document.getElementById('alert-ok-button').addEventListener('click', hideCustomAlert);
        
        // --- Email Modal Functions ---
        const emailModal = document.getElementById('email-modal');
        const emailDraftArea = document.getElementById('email-draft-area');
        const sendEmailButton = document.getElementById('send-email-button');
        const closeEmailModal = document.getElementById('close-email-modal');
        
        function showEmailModal(draftText) {
            emailDraftArea.value = draftText;
            emailModal.style.display = 'block';
            document.getElementById('modal-backdrop').style.display = 'block';
        }
        
        function hideEmailModal() {
            emailModal.style.display = 'none';
            document.getElementById('modal-backdrop').style.display = 'none';
        }
        
        closeEmailModal.addEventListener('click', hideEmailModal);
        sendEmailButton.addEventListener('click', () => {
            showCustomAlert("Email sent successfully!");
            hideEmailModal();
        });


        // --- Global State & DOM Elements ---
        let isLoggedIn = false;
        let currentUserId = null; // Mock user ID
        const appContainer = document.getElementById('app');
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.main-nav a, [data-nav-target]');
        const loginBtn = document.getElementById('login-button');
        const signupBtn = document.getElementById('signup-button');
        const logoutBtn = document.getElementById('logout-button');
        const showLoginBtn = document.getElementById('show-login');
        const showSignupBtn = document.getElementById('show-signup');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const switchToLoginLink = document.getElementById('switch-to-login');
        
        // Leaflet Map related globals
        let map;
        const markers = new Map();

        // Chatbot related globals
        const chatbotContainer = document.getElementById('chatbot-container');
        const chatbotToggleBtn = document.getElementById('chatbot-toggle-button');
        const chatbotCloseBtn = document.getElementById('chatbot-close-btn');
        const chatbotMessages = document.getElementById('chatbot-messages');
        const chatbotInput = document.getElementById('chatbot-input');
        const chatbotSendBtn = document.getElementById('chatbot-send-btn');
        let isChatbotOpen = false;

        // Authentication buttons
        const loginSubmitBtn = document.getElementById('login-submit');
        const signupSubmitBtn = document.getElementById('signup-submit');
        const googleOAuthBtn = document.getElementById('google-oauth-button');
        
        // Property action buttons
        const addToLeadsBtn = document.getElementById('add-to-leads-button');
        const contactOwnerBtn = document.getElementById('contact-owner-button');
        const startDDButton = document.getElementById('start-dd-button');
        const aiSummaryButton = document.getElementById('ai-summary-button');

        // Due Diligence Page Buttons
        const runDDAgentButton = document.getElementById('run-dd-agent-button');
        const pullDataButton = document.getElementById('pull-data-button');

        // Feedback Buttons
        const feedbackYesButton = document.getElementById('feedback-yes-button');
        const feedbackNoButton = document.getElementById('feedback-no-button');

        // --- Navigation Logic ---
        function navigateTo(pageId, propertyId = null) {
            pages.forEach(page => page.classList.remove('active'));
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }

            // Update active nav link
            navLinks.forEach(link => link.classList.remove('active'));
            const activeNavLink = document.querySelector(`.main-nav a[data-nav-target="${pageId}"]`);
            if (activeNavLink) {
                activeNavLink.classList.add('active');
            }

            // Special handling for dashboard/property detail
            if (pageId === 'dashboard-section' && isLoggedIn) {
                renderPropertyList();
                renderMap();
            } else if (pageId === 'property-detail-section' && propertyId !== null) {
                renderPropertyDetail(propertyId);
            } else if (pageId === 'auth-section' && isLoggedIn) {
                // If trying to navigate to auth when logged in, redirect to dashboard
                navigateTo('dashboard-section');
            } else if (pageId !== 'hero-section' && !isLoggedIn && pageId !== 'auth-section') {
                // Redirect to login if trying to access protected page while logged out
                navigateTo('auth-section');
                showCustomAlert('Please login to access this section.');
            }
        }

        // --- Event Listeners for Navigation ---
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = e.target.dataset.navTarget;
                if (targetId) {
                    navigateTo(targetId);
                }
            });
        });

        // --- Authentication Logic (still using mock data) ---
        function updateAuthUI() {
            if (isLoggedIn) {
                loginBtn.style.display = 'none';
                signupBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
            } else {
                loginBtn.style.display = 'inline-block';
                signupBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
            }
        }

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (email && password) {
                // Mock authentication logic
                if (email === 'demo@nexagent.com' && password === 'password123') {
                    isLoggedIn = true;
                    currentUserId = 'demo-user-123';
                    updateAuthUI();
                    showCustomAlert('Login successful!');
                    navigateTo('dashboard-section');
                } else {
                    showCustomAlert('Invalid credentials. Use demo@nexagent.com / password123');
                }
            } else {
                showCustomAlert('Please enter both email and password.');
            }
        }

        function handleSignup() {
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;

            if (email && password && confirmPassword) {
                if (password !== confirmPassword) {
                    showCustomAlert('Passwords do not match.');
                    return;
                }
                // Mock signup logic
                showCustomAlert('Signup successful for ' + email + '! Please login.');
                document.getElementById('login-email').value = email;
                document.getElementById('login-password').value = password;
                showLoginForm();
            } else {
                showCustomAlert('Please fill in all fields.');
            }
        }

        function handleGoogleOAuth() {
            // Mock Google OAuth flow
            showCustomAlert('Redirecting to Google for authentication (mockup)...');
            setTimeout(() => {
                isLoggedIn = true;
                currentUserId = 'google-user-456';
                updateAuthUI();
                showCustomAlert('Google OAuth successful! Logged in.');
                navigateTo('dashboard-section');
            }, 1500);
        }

        function handleLogout() {
            isLoggedIn = false;
            currentUserId = null;
            updateAuthUI();
            showCustomAlert('Logged out successfully.');
            navigateTo('hero-section');
        }

        // Attach event listeners to buttons
        loginSubmitBtn.addEventListener('click', handleLogin);
        signupSubmitBtn.addEventListener('click', handleSignup);
        googleOAuthBtn.addEventListener('click', handleGoogleOAuth);
        addToLeadsBtn.addEventListener('click', () => showCustomAlert('Added to Leads!'));
        
        // This button now triggers a modal with an email draft (Simulated Communication Agent)
        contactOwnerBtn.addEventListener('click', () => {
             const propTitle = document.getElementById('detail-prop-title').textContent;
             const draft = `Subject: Inquiry regarding ${propTitle}\n\nDear Owner,\n\nI am writing to express my interest in your property located at ${document.getElementById('detail-prop-address').textContent}. I have reviewed the details and would like to learn more about the property and discuss a potential offer.\n\nPlease let me know a convenient time to connect.\n\nSincerely,\nNexAgent AI`;
             showEmailModal(draft);
        });
        
        startDDButton.addEventListener('click', () => {
             navigateTo('due-diligence-section', 0);
             runDueDiligenceAgentDemo();
        });
        aiSummaryButton.addEventListener('click', generateAISummary);
        runDDAgentButton.addEventListener('click', runDueDiligenceAgentDemo);
        pullDataButton.addEventListener('click', pullMoreDataSimulation);

        // Continuous Learning Feedback (Simulated)
        feedbackYesButton.addEventListener('click', () => {
            showCustomAlert("Thank you for your feedback! This data will be used to improve our AI models.");
        });
        feedbackNoButton.addEventListener('click', () => {
            showCustomAlert("Thank you for your feedback. Our agents will review this insight to improve future analysis.");
        });


        loginBtn.addEventListener('click', () => { showLoginForm(); navigateTo('auth-section'); });
        signupBtn.addEventListener('click', () => { showSignupForm(); navigateTo('auth-section'); });
        logoutBtn.addEventListener('click', handleLogout);

        showLoginBtn.addEventListener('click', showLoginForm);
        showSignupBtn.addEventListener('click', showSignupForm);
        switchToLoginLink.addEventListener('click', (e) => { e.preventDefault(); showLoginForm(); });

        function showLoginForm() {
            loginForm.style.display = 'block';
            signupForm.style.display = 'none';
            showLoginBtn.classList.add('active');
            showSignupBtn.classList.remove('active');
        }

        function showSignupForm() {
            loginForm.style.display = 'none';
            signupForm.style.display = 'block';
            showLoginBtn.classList.remove('active');
            showSignupBtn.classList.add('active');
        }

        // --- Dashboard Logic ---
        const mockProperties = [
            { id: 1, title: 'Luxury Condo Tech Hub', address: 'Bandra, Mumbai', price: '1,500,000', beds: 3, baths: 2.5, sqft: 2200, tags: ['High Yield', 'Undervalued'], description: "A state-of-the-art condominium designed for the future, featuring smart home integration, panoramic city views, and unparalleled amenities. Located in the heart of the burgeoning tech district. This property offers a unique blend of urban convenience and modern luxury, making it an ideal investment for tech professionals. The building features a rooftop infinity pool, a fully-equipped gym, and 24/7 concierge service.", lat: 19.05, lng: 72.82, image: "https://images.pexels.com/photos/186077/pexels-photo-186077.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" },
            { id: 2, title: 'Downtown Lofts', address: 'Fort, Mumbai', price: '850,000', beds: 2, baths: 2, sqft: 1500, tags: ['Risky', 'High Yield'], description: "Industrial-chic loft in a vibrant downtown area. Excellent for urban living, though some revitalization projects are ongoing nearby. The property features exposed brick walls, high ceilings, and large windows with city views. While there's potential for high rental yield, the ongoing construction might affect tenant interest in the short term. The location is a short walk from major business hubs.", lat: 18.92, lng: 72.83, image: "https://images.pexels.com/photos/106399/pexels-photo-106399.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" },
            { id: 3, title: 'Suburban Smart Home', address: 'Versova, Mumbai', price: '1,100,000', beds: 4, baths: 3, sqft: 2800, tags: ['High Yield'], description: "Family-friendly smart home with integrated solar panels and energy-efficient systems. Located in a top-rated school district. This property is perfect for families looking for a safe and modern environment. The home includes a landscaped backyard, a spacious two-car garage, and a state-of-the-art security system. Its location offers a peaceful escape from the city's hustle.", lat: 19.12, lng: 72.80, image: "https://images.pexels.com/photos/208736/pexels-photo-208736.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" },
            { id: 4, title: 'Commercial Office Space', address: 'BKC, Mumbai', price: '3,200,000', beds: 0, baths: 0, sqft: 10000, tags: ['High Yield'], description: "Prime commercial office space in a thriving business park. Ideal for tech startups or established corporations seeking expansion. The building is equipped with fiber internet, modern conference rooms, and a cafeteria. Its proximity to major transportation hubs and the city center makes it a highly desirable location for businesses.", lat: 19.05, lng: 72.86, image: "https://images.pexels.com/photos/267507/pexels-photo-267507.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1" }
        ];

        function renderPropertyList() {
            const propertyListDiv = document.getElementById('property-list');
            propertyListDiv.innerHTML = ''; // Clear previous list

            mockProperties.forEach(prop => {
                const propCard = document.createElement('div');
                propCard.classList.add('property-card');
                propCard.addEventListener('click', () => {
                    navigateTo('property-detail-section', prop.id);
                    highlightPropertyOnMap(prop.id);
                });
                propCard.innerHTML = `
                    <div class="property-thumbnail">
                        <img src="${prop.image}" alt="${prop.title}">
                    </div>
                    <div class="property-info">
                        <h3>${prop.title}</h3>
                        <p>${prop.address}</p>
                        <p><strong>$${prop.price}</strong> | ${prop.beds} Beds | ${prop.baths} Baths</p>
                        <div class="property-tags">
                            ${prop.tags.map(tag => `<span class="tag ${tag.toLowerCase().replace(' ', '-')}">${tag}</span>`).join('')}
                        </div>
                    </div>
                `;
                propertyListDiv.appendChild(propCard);
            });
        }

        // --- Map Logic ---
        function renderMap() {
            if (map) {
                map.remove(); // Remove existing map instance if it exists
            }
            map = L.map('map').setView([19.0760, 72.8777], 12); // Center on Mumbai, India

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            mockProperties.forEach(prop => {
                const marker = L.marker([prop.lat, prop.lng]).addTo(map);
                marker.bindPopup(`<b>${prop.title}</b><br>${prop.address}<br>Price: $${prop.price}`);
                marker.id = prop.id;
                markers.set(prop.id, marker);
            });
        }

        function highlightPropertyOnMap(propertyId) {
            const marker = markers.get(propertyId);
            if (marker) {
                map.flyTo(marker.getLatLng(), 15);
                marker.openPopup();
            }
        }


        // --- Property Detail Logic ---
        function renderPropertyDetail(propertyId) {
            const prop = mockProperties.find(p => p.id === propertyId);
            if (!prop) {
                showCustomAlert('Property not found!');
                navigateTo('dashboard-section');
                return;
            }

            document.getElementById('detail-prop-title').textContent = prop.title;
            document.getElementById('detail-prop-address').textContent = prop.address;
            document.getElementById('detail-prop-price').textContent = prop.price;
            document.getElementById('detail-prop-beds').textContent = prop.beds;
            document.getElementById('detail-prop-baths').textContent = prop.baths;
            document.getElementById('detail-prop-sqft').textContent = prop.sqft;
            document.getElementById('detail-prop-description').textContent = prop.description;
            document.querySelector('#property-detail-section .prop-image').innerHTML = `<img src="${prop.image}" alt="${prop.title}">`;

            // Mock Explainable AI Insights based on tags
            const explainableAiList = document.getElementById('explainable-ai-list');
            explainableAiList.innerHTML = '';
            const insights = [];
            if (prop.tags.includes('High Yield')) insights.push('Market Sentiment: "Strong Growth Potential (92%) due to recent tech company influx."');
            if (prop.tags.includes('Risky')) insights.push('Risk Assessment: "Medium-High. Potential for interest rate hikes affecting financing and local revitalization challenges."');
            if (prop.tags.includes('Undervalued')) insights.push('Comparative Analysis: "Valued ~8% below comparable properties in the last 6 months, indicating an opportunity."');
            insights.push('Future Outlook: "Projected 15% appreciation over next 3 years based on urban development plans."'); // Generic for all
            insights.forEach(insight => {
                const li = document.createElement('li');
                li.textContent = insight;
                explainableAiList.appendChild(li);
            });
        }
        
        // --- Due Diligence Agent Demo Logic ---
        async function runDueDiligenceAgentDemo() {
            const inspectionReportText = document.getElementById('inspection-report').value;
            const contractText = document.getElementById('contract-text').value;
            const ddResultArea = document.getElementById('dd-result-area');

            if (!inspectionReportText.trim() && !contractText.trim()) {
                showCustomAlert("Please provide text for at least one document to run the Due Diligence Agent.");
                return;
            }

            ddResultArea.textContent = 'Due Diligence Agent is processing...';
            resetDDStatus();

            // Simulate agent workflow
            await simulateAgentActivity('status-workflow', 'Workflow Coordinator: Initiating document analysis...', 500);
            await simulateAgentActivity('status-data-underwriting', 'Data & Underwriting Agent: Fetching historical data (Realie API, ATTOM readiness)...', 1000);
            await simulateAgentActivity('status-dd-agent', 'Due Diligence Agent: Analyzing reports and contracts...', 2000);
            
            try {
                const systemPrompt = "You are an AI due diligence agent specializing in real estate. Analyze the provided inspection and contract text. Identify and list all potential risks, red flags, and key recommendations based on the documents. Format the output in a clear report with sections for 'Risks', 'Red Flags', and 'Recommendations'. Be concise and direct.";
                const userQuery = `Inspection Report: ${inspectionReportText}\n\nContract Text: ${contractText}`;
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    }
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Analysis failed to produce a result.";
                ddResultArea.textContent = text;

            } catch (error) {
                console.error("Gemini API Error:", error);
                ddResultArea.textContent = "Analysis failed due to an API error. Please try again.";
            }

            await simulateAgentActivity('status-negotiation-comm', 'Negotiation/Communication Agent: Preparing summary for stakeholders...', 1000);
            document.getElementById('status-dd-agent').classList.remove('active'); // DD agent finished its core task
            document.getElementById('status-negotiation-comm').classList.remove('active');
            document.getElementById('status-workflow').classList.remove('active');
            document.getElementById('status-data-underwriting').classList.remove('active');
            
            // Final status message
            document.getElementById('status-workflow').innerHTML = '<span class="dd-status-indicator"></span>Workflow Coordinator: Task Completed';
            document.getElementById('status-data-underwriting').innerHTML = '<span class="dd-status-indicator"></span>Data & Underwriting Agent: Data Verified';
            document.getElementById('status-dd-agent').innerHTML = '<span class="dd-status-indicator"></span>Due Diligence Agent: Report Generated';
            document.getElementById('status-negotiation-comm').innerHTML = '<span class="dd-status-indicator"></span>Negotiation/Communication Agent: Ready for Outreach';
        }
        
        // Simulates a new data pull from an external source (Plug-and-play feature)
        async function pullMoreDataSimulation() {
            const inspectionReportText = document.getElementById('inspection-report');
            const contractText = document.getElementById('contract-text');
            
            pullDataButton.disabled = true;
            const originalText = pullDataButton.innerHTML;
            pullDataButton.innerHTML = 'Loading...';
            
            await new Promise(resolve => setTimeout(resolve, 1500)); // Simulate API call delay
            
            inspectionReportText.value = `
HVAC unit is 18 years old, nearing end of life.
Roof has major wear, requires immediate replacement.
Electrical panel is outdated, high risk of failure.
Basement shows signs of active moisture intrusion, major water damage found. Structural damage detected on main support beam.
Environmental check: Historical record of a previous hazardous material spill on site.
Permits: No permits found for the last 10 years of renovations.
            `.trim();
            
            contractText.value = `
Lease agreement for Tenant A expires on 2024-12-31. Rent: $3000/month.
Property has a recorded easement for public utility access along the northern boundary.
Active litigation found: Property owner is being sued for construction defects.
Purchase price $1.2M. Closing date 2023-11-15.
Seller warrants no undisclosed defects, but this is contradicted by new data.
            `.trim();
            
            pullDataButton.innerHTML = originalText;
            pullDataButton.disabled = false;
            showCustomAlert("New data pulled and loaded from external API (simulated). You can now run the agent again.");
        }

        function resetDDStatus() {
            document.querySelectorAll('.dd-status div').forEach(div => {
                div.classList.remove('active');
                if(div.id === 'status-workflow') div.textContent = 'Workflow Coordinator: Awaiting Input';
                else if(div.id === 'status-data-underwriting') div.textContent = 'Data & Underwriting Agent: Idle';
                else if(div.id === 'status-dd-agent') div.textContent = 'Due Diligence Agent: Idle';
                else if(div.id === 'status-negotiation-comm') div.textContent = 'Negotiation/Communication Agent: Idle';
            });
        }

        async function simulateAgentActivity(statusId, message, delay) {
            const statusDiv = document.getElementById(statusId);
            statusDiv.classList.add('active');
            statusDiv.innerHTML = `<span class="dd-status-indicator"></span>${message}`;
            return new Promise(resolve => setTimeout(resolve, delay));
        }

        // --- New Gemini API Feature: Property Summary ---
        async function generateAISummary() {
            const descriptionText = document.getElementById('detail-prop-description').textContent;
            if (!descriptionText.trim()) {
                showCustomAlert("No property description to summarize.");
                return;
            }

            const aiSummaryButton = document.getElementById('ai-summary-button');
            const originalButtonText = aiSummaryButton.innerHTML;
            aiSummaryButton.disabled = true;
            aiSummaryButton.innerHTML = "✨ Summarizing...";

            try {
                const systemPrompt = "You are a helpful AI assistant. Summarize the following real estate property description into a single, concise paragraph.";
                const userQuery = descriptionText;
                
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    }
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const summaryText = result?.candidates?.[0]?.content?.parts?.[0]?.text || "Summary failed to generate.";
                
                showCustomAlert(summaryText);

            } catch (error) {
                console.error("Gemini API Error:", error);
                showCustomAlert("An error occurred while generating the summary.");
            } finally {
                aiSummaryButton.disabled = false;
                aiSummaryButton.innerHTML = originalButtonText;
            }
        }


        // --- Chatbot Logic ---
        function toggleChatbot() {
            isChatbotOpen = !isChatbotOpen;
            if (isChatbotOpen) {
                chatbotContainer.style.display = 'flex';
            } else {
                chatbotContainer.style.display = 'none';
            }
        }
        
        async function handleChatInput() {
            const userInput = chatbotInput.value.trim();
            if (userInput === '') return;

            // Display user message
            appendMessage(userInput, 'user');
            chatbotInput.value = '';

            // Add loading indicator for bot response
            const loadingMessage = appendMessage('', 'bot');
            loadingMessage.innerHTML = '<div class="loading-dots"><span></span><span></span><span></span></div>';
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;

            try {
                // Call Gemini API
                const systemPrompt = "You are a real estate expert. Give concise, accurate, and helpful answers. Identify yourself as 'AI Assistant'.";
                const userQuery = userInput;
                const apiKey = "";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: userQuery }] }],
                    tools: [{ "google_search": {} }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    }
                };
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    loadingMessage.innerHTML = text;
                } else {
                    loadingMessage.innerHTML = "I'm sorry, I cannot help you at this time.";
                }
            } catch (error) {
                console.error("Gemini API Error:", error);
                loadingMessage.innerHTML = "I'm sorry, an error occurred. Please try again later.";
            }
            
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function appendMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message', sender);
            messageDiv.textContent = text;
            chatbotMessages.appendChild(messageDiv);
            return messageDiv;
        }

        // --- Scalability & Feedback Sparkline Logic ---
        function generateSparklineData(min, max, count) {
            return Array.from({ length: count }, () => Math.floor(Math.random() * (max - min + 1)) + min);
        }

        function renderSparkline(containerId, data) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            const maxHeight = container.clientHeight - 10; // Account for padding
            const maxValue = Math.max(...data);

            data.forEach(value => {
                const bar = document.createElement('div');
                bar.classList.add('sparkline-bar');
                bar.style.height = `${(value / maxValue) * maxHeight}px`;
                container.appendChild(bar);
            });
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            updateAuthUI();
            navigateTo('hero-section'); // Start on the hero page

            // Event Listeners for Chatbot
            chatbotToggleBtn.addEventListener('click', toggleChatbot);
            chatbotCloseBtn.addEventListener('click', toggleChatbot);
            chatbotSendBtn.addEventListener('click', handleChatInput);
            chatbotInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleChatInput();
                }
            });

            // Render sparklines after the page is active and visible
            const recordsData = generateSparklineData(50, 100, 30); // Millions of records
            const agentsData = generateSparklineData(10, 50, 30); // Horizontal agent scaling
            renderSparkline('sparkline-records', recordsData);
            renderSparkline('sparkline-agents', agentsData);
            
            // Periodically update sparklines for dynamic feel
            setInterval(() => {
                const newRecordsData = generateSparklineData(50, 100, 30);
                const newAgentsData = generateSparklineData(10, 50, 30);
                renderSparkline('sparkline-records', newRecordsData);
                renderSparkline('sparkline-agents', newAgentsData);
            }, 5000);
        });
    </script>
</body>
</html>
